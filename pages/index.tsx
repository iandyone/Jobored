import Head from "next/head";
import styles from "@/styles/Home.module.scss";
import FiltersBar from "@/components/filtersBar";
import { FC, useEffect } from "react";
import { IAuthResponse, IVacancy } from "@/types";
import axios from "@/axios";
import { useDispatchTyped } from "@/hooks/redux";
import fetchCatalogAsync from "@/store/actions/filter-actions";
import { getAuthorization, getVacancies } from "@/helpers/fetchers";

export async function getStaticProps() {
  const accessToken = await getAuthorization() || '';

  const vacancies = await getVacancies(accessToken) || ''

  // if (!vacancies && !accessToken) {
  //   return { notFound: true };
  // }

  return {
    props: { vacancies, accessToken },
  };
}

interface HomeProps {
  vacancies: IVacancy[];
  accessToken: string;
}


const Home: FC<HomeProps> = ({ accessToken, vacancies }) => {
  console.log(vacancies);
  const dispatch = useDispatchTyped();

  useEffect(() => {
    localStorage.setItem("Access", accessToken);
    dispatch(fetchCatalogAsync());
  }, []);

  return (
    <>
      <Head>
        <title>Jobored | Main</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <section className={styles.jobs}>
        <div className='jobs__container container'>
          <div className='jobs__body'>
            <FiltersBar />
          </div>
        </div>
      </section>
    </>
  );
};

export default Home;
