import Head from "next/head";
import styles from "@/styles/Home.module.scss";
import FiltersBar from "@/components/filtersBar";
import { FC, useEffect } from "react";
import { IAuthResponse, IVacancy } from "@/types";
import axios from "@/axios";

export async function getStaticProps() {
  const authResponse = await axios.get<IAuthResponse>("/oauth2/password", {
    params: {
      login: "sergei.stralenia@gmail.com",
      password: "paralect123",
      client_id: 2231,
      client_secret: "v3.r.137440105.399b9c5f19384345afe0ad0339e619e71c66af1d.800f8642a38256679e908c370c44267f705c2909",
      hr: 0,
    },
  });

  const accessToken = `${authResponse.data.token_type} ${authResponse.data.access_token}`;

  interface VacancyResponse {
    more: boolean;
    objects: IVacancy[];
    total: number;
  }

  const vacanciesResponse = await axios.get<VacancyResponse>("/vacancies", {
    params: {
      page: 1,
      count: 4,
    },
    headers: {
      Authorization: accessToken,
    },
  });

  if (!vacanciesResponse.data && !authResponse.data) {
    return { notFound: true };
  }

  return {
    props: { vacancies: vacanciesResponse.data, accessToken },
  };
}

interface HomeProps {
  vacancies: IVacancy[];
  accessToken: string;
}

const Home: FC<HomeProps> = ({ accessToken, vacancies }) => {
  console.log(vacancies);

  useEffect(() => {
    localStorage.setItem("Access", accessToken);
  }, []);

  return (
    <>
      <Head>
        <title>Jobored | Main</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <section className={styles.jobs}>
        <div className='jobs__container container'>
          <div className='jobs__body'>
            <FiltersBar />
          </div>
        </div>
      </section>
    </>
  );
};

export default Home;
